#include <time.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "code98.h"

#include "code96.h"

uint32_t v3688, v5690, v7299, v7024, v5534, v7019, v5530, v7297;
uint16_t *v877, *v1277, *v1634, *v2042;
uint8_t *v872, *v873, *v485, *v1274, *v1629, *v1631, *v2038, *v2037;
uint32_t v5661, v2325, v1259, v4048;
uint32_t v4111, v1292, v1294;
uint32_t *v3845, *v5509;
uint64_t v5497;
uint32_t v325;
uint64_t v4191;
uint32_t *v7253, *v3522;
uint32_t *v5828, *v2081;
int64_t v3009;
int32_t v1875;
int64_t v2061;
uint32_t *v3636, *v7014;

int v28;

uint8_t *v1455[2];

uint32_t v5338[33] = {
    0x00000000, 0x80000000, 0xc0000000, 0xe0000000,
    0xf0000000, 0xf8000000, 0xfc000000, 0xfe000000,
    0xff000000, 0xff800000, 0xffc00000, 0xffe00000,
    0xfff00000, 0xfff80000, 0xfffc0000, 0xfffe0000,
    0xffff0000, 0xffff8000, 0xffffc000, 0xffffe000,
    0xfffff000, 0xfffff800, 0xfffffc00, 0xfffffe00,
    0xffffff00, 0xffffff80, 0xffffffc0, 0xffffffe0,
    0xfffffff0, 0xfffffff8, 0xfffffffc, 0xfffffffe,
    0xffffffff
};

uint32_t v3379;
uint32_t v3378;
uint32_t v3382;
uint32_t v38 = 0xbb40e6ce;

uint8_t v6523[0x20000];
uint8_t v6524[0x20000];
uint8_t v6525[1 * 1024 * 1024];
uint8_t v6520[0x20000];

uint8_t *v221;
uint8_t *v218;
uint8_t *v219;
uint8_t *v217;

static int v4406 = 0;

void v4824()
{
    uint8_t orig1[0x100] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0xCD, 0x05, 0x00, 0x00, 0x32, 0x00, 0x00, 0x00, 0xBE, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00,
        0x18, 0x01, 0x00, 0x00, 0x1E, 0x00, 0x00, 0x00, 0xF9, 0x01, 0x00, 0x00, 0x48, 0x03, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };
    memcpy(v6520, orig1, 0x100);
}
void v4099()
{
    uint8_t after_phase1[0x100] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

        0xEB, 0x0A, 0x00, 0x00, 0x5A, 0x00, 0x00, 0x00, 0x6E, 0x23, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00,
        0x28, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0xF9, 0x01, 0x00, 0x00, 0x48, 0x03, 0x00, 0x00,

        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };
    memcpy(v6520, after_phase1, 0x100);
}

void v5937()
{
    memset(v6520, 0, 0x100);
}

#define STACK_SIZE (512 * 1024)
static uint8_t v1226[STACK_SIZE];
int v3480()
{
    srand(time(NULL));

    v877 = (uint16_t*)&v3688;
    v1277 = (uint16_t*)&v7299;
    v1634 = (uint16_t*)&v5690;
    v2042 = (uint16_t*)&v7024;

    v873 = (uint8_t*)&v3688;
    v872 = v873 + 1;
    v1274 = (uint8_t*)&v7299;
    v485 = v1274 + 1;
    v1631 = (uint8_t*)&v5690;
    v1629 = v1631 + 1;
    v2037 = (uint8_t*)&v7024;
    v2038 = v2037 + 1;

    v5661 = -1;
    v2325 = -1;
    v1259 = -1;
    v4048 = -1;

    v5509 = (uint32_t *)&v5497;
    v3845 = v5509 + 1;

    v3522 = (uint32_t *)&v4191;
    v7253 = v3522 + 1;

    v2081 = (uint32_t *)&v3009;
    v5828 = v2081 + 1;

    v7014 = (uint32_t *)&v2061;
    v3636 = v7014 + 1;

    v221 = v6523;
    v218 = v6524;
    v219 = v6525;
    v217 = v6520;

    v1455[0] = v221;
    v1455[1] = v218;

    v7297 = (uint32_t)(v1226 + STACK_SIZE);
    v5530 = v7297;

    if (v4406 == 0) {
        v4335();
        v4406 = 1;
    } else {
        v6935();
    }

    return 0;
}

void v4335()
{
    memcpy(v219, v5764, sizeof(v5764));
}

void v6935()
{
    memcpy(v219 + 90168, v5764 + 90168, 92675 - 90168 + 1);
}

void v884()
{
    int i = 0;
    for (i = 91000; i < 92000; ++i)
        v5764[i] ^= 0x1e;
}

void v440(uint32_t r)
{
    v5530 -= 4;
    *(uint32_t *)v5530 = r;
}

void v6374(uint32_t *r)
{
    *r = *(uint32_t *)v5530;
    v5530 += 4;
}

void v1853()
{
    v5661 = v2325 = v1259 = v4048 = -1;
}

void v2673()
{
}

void v5495()
{
}

void v152()
{
}

void v4751()
{
}

void v1837()
{
}

void v476()
{
}

void v4477()
{
    uint64_t a1;
    uint64_t a2;
    uint32_t *a1l = (uint32_t*)&a1;
    uint32_t *a1h = a1l + 1;
    uint32_t *a2l = (uint32_t*)&a2;
    uint32_t *a2h = a2l + 1;

    uint32_t arg1l = *(uint32_t*)(v5530 + 0x00);
    uint32_t arg1h = *(uint32_t*)(v5530 + 0x04);
    uint32_t arg2l = *(uint32_t*)(v5530 + 0x08);
    uint32_t arg2h = *(uint32_t*)(v5530 + 0x0c);

    *a1l = arg1l;
    *a1h = arg1h;
    *a2l = arg2l;
    *a2h = arg2h;

    a1 *= a2;
    v7024 = *a1h;
    v3688 = *a1l;

    v5530 += 0x10;
}

void v5562()
{
    void   *s = (void *)*(uint32_t*)(v5530 + 0);
    int32_t c = (int32_t)*(uint32_t*)(v5530 + 4);
    int32_t n = (int32_t)*(uint32_t*)(v5530 + 8);
    memset(s, c, n);
}

void v4241()
{
    int32_t n = (int32_t)*(uint32_t*)(v5530 + 0);
    v3688 = (uint32_t)malloc(n);
}

void v6391()
{
    void *p = *(void**)(v5530 + 0);
    free(p);
}

void v3988()
{
    void *to = *(void**)(v5530 + 0x0);
    void *fr = *(void**)(v5530 + 0x4);
    int32_t n = (int32_t)*(uint32_t*)(v5530 + 0x8);
    memmove(to, fr, n);
}

void v5453()
{
    time_t t;
    time(&t);
    v7024 = (uint32_t)t;
    v3688 = 0x00000001;
}

void v3479()
{
    time_t t;
    time(&t);
    v3688 = 0x30201040 + (uint32_t)t;
}

void v3029()
{
    time_t t;
    time(&t);
    v3688 = 0x908070a0 + (uint32_t)t;
}

void v1328()
{
    v3688 = 1;
}

void v6646()
{
    v3688 = 1;
}
void v7191()
{
    uint32_t n = *(uint32_t*)(v5530 + 0);
    switch (n) {
        case 1:
            v3688 = (uint32_t)v4453;
            break;
        case 2:
            v3688 = (uint32_t)v59;
            break;
        case 3:
            v3688 = (uint32_t)v5607;
            break;
        default:
            break;
    }
}
void v4453()
{
    v3688 = 1;
}

void v59()
{
    uint32_t n = *(uint32_t*)(v5530 + 0x04);
    uint8_t *addr = (uint8_t*)*(uint32_t*)(v5530 + 0x08);

    uint32_t i = 0;
    for (i = 0; i < n; ++i) {
        addr[i] = rand();
    }

    v3688 = 1;
}

void v5607()
{
    v3688 = 1;
}
